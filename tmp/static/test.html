<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scraper Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }
        .scraper-section {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Scraper Results</h1>

        <!-- Slider for Limit -->
        <div class="mb-4">
            <label for="limitSlider" class="form-label">Select Result Limit: <span id="limitValue">5</span></label>
            <input type="range" class="form-range" min="1" max="20" step="1" id="limitSlider" value="5">
        </div>

        <!-- List of Scrapers -->
        <h2>Available Scrapers</h2>
        <ul id="scraperList" class="list-unstyled"></ul>

        <!-- Scraper Results Section -->
        <div id="scraperResults" class="scraper-section"></div>
    </div>

    <script>
        // Fetch list of scrapers and display them as links with anchors
        async function fetchScrapers() {
            try {
                const response = await fetch('http://localhost:8000/api/scraper');
                if (!response.ok) {
                    throw new Error('Failed to fetch scraper list');
                }

                const scrapers = await response.json();
                const scraperList = document.getElementById('scraperList');
                const scraperResults = document.getElementById('scraperResults');

                scrapers.forEach(scraper => {
                    // Create an anchor in the list
                    const listItem = document.createElement('li');
                    const anchor = document.createElement('a');
                    anchor.href = `#${scraper}`;
                    anchor.textContent = scraper;
                    listItem.appendChild(anchor);
                    scraperList.appendChild(listItem);

                    // Create a section for scraper results
                    const scraperSection = document.createElement('div');
                    scraperSection.id = scraper;
                    scraperSection.innerHTML = `
                        <h3>${scraper}</h3>
                        <pre id="${scraper}-results" class="bg-light p-3"></pre>
                    `;
                    scraperResults.appendChild(scraperSection);

                    // Fetch and display scraper results
                    fetchScraperResults(scraper);
                });
            } catch (error) {
                console.error(error);
                alert('Error fetching scrapers. Please check the console.');
            }
        }

        // Fetch and display results of individual scrapers
        async function fetchScraperResults(scraper, limit = 5) {
            try {
                const url = `http://localhost:8000/api/scraper/${scraper}?limit=${limit}`;
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Failed to fetch results for ${scraper}`);
                }

                const results = await response.json();
                const resultElement = document.getElementById(`${scraper}-results`);
                resultElement.textContent = JSON.stringify(results, null, 2);
            } catch (error) {
                console.error(error);
            }
        }

        // Update scraper results when the limit slider is changed
        document.getElementById('limitSlider').addEventListener('input', (event) => {
            const limit = event.target.value;
            document.getElementById('limitValue').textContent = limit;

            // Re-fetch all scraper results with the new limit
            const scrapers = document.querySelectorAll('#scraperList a');
            scrapers.forEach(scraperLink => {
                const scraper = scraperLink.textContent;
                fetchScraperResults(scraper, limit);
            });
        });

        // Initial fetch of scrapers and results
        fetchScrapers();
    </script>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</body>
</html>
